# 传统上，局域网使用广播技术，广域网使用点对点交换技术，城域网使用以太网技术

# 中继器和桥接器是用于局域网的物理层和数据链路层的联网设备

===OSI体系结构===
==重点==
= 复杂不实用
= 低三层为通信子网，是为了联网而附加的通信设备，完成数据传输的功能
= 高三层称为资源子网，相当于计算机系统，完成数据的处理等功能
	1、物理层(集线器，比特流)：
		1.1、传输单位为比特
		1.2、功能：在物理媒体上为数据端设备透明地传输原始比特流
		1.3、主要定义数据终端设备DTE和数据通信设备DCE的物理与逻辑连接方法，如电路接口、机械形状和尺寸、传输信号的意义和电气特性
		1.4、协议/规程：EIA-232C、EIA/TIA RS-449、CCITT的X.21
		==物理媒体== 传输信息所利用的物理媒体，如双绞线等并不在物理层协议之内而在物理层协议下面

	2、数据链路层(交换机，帧)
		2.1、传输单位为帧
		2.2、功能：将网络层传来的IP数据报组装成帧（成帧、差错控制、流量控制、传输管理）
		2.3、协议：SDLC、HDLC、PPP、STP、帧中继
		2.4、点到点通信（主机间通信）
	
	3、网络层(路由器，数据报/分组)：
		3.1、传输单位为数据报
		3.2、关心通信子网的运行控制，把网络层的协议数据单元从源端传到目的端，为分组交换网上的不同主机提供通信服务
		3.3、功能：对分组进行路由选择、实现流量控制、拥塞控制、差错控制、网际互连等
		3.4、协议：IP、IPX、ICMP、IGMP、ARP、RARP、OSPF

	4、传输层/运输层(报文段tcp/数据报udp)
		4.1、负责两个主机间进程的通信
		4.2、功能：为端到端连接提供可靠的传输服务，提供流量控制、差错控制、服务质量、数据传输管理
		4.3、端到端通信（进程间通信）

	5、会话层
		5.1、允许不同主机上的各个进程之间进行会话
		5.2、表示层实体或用户进程建立连接并在连接上有序地传输数据，就是会话，也称建立同步
		5.3、管理主机间的会话进程（建立、管理、终止进程间会话）
		5.4、使用校验点使得在校验点继续恢复通信，实现数据同步

	6、表示层
		6.1、处理在两个通信系统中交换信息的表示方式
		6.2、采用标注的编码形式
		6.3、数据压缩、加密、解密的等数据表示变换功能

	7、应用层
		7.1、用户与网络的界面、为特定类型的网络应用提供访问OSI参考模型环境的手段；（FTP、SMTP、HTTP）

===TCP/IP体系结构===
	1、链路层/网络接口层
		1.1、协议：与物理网络的接口，可以是各种类型局域网（以太网、令牌环网、令牌总线网）或公共数据网络（电话网、SDH、X.25、帧中继、ATM异步传输模式）
		1.2、功能：从主机或节点接受IP分组，并把它们发送到指定的物理网络上

	2、网际层（关键部分）
		tip：与OSI相似
		2.1、协议：IP
		2.2、功能：将分组发往任何网络，并为之独立的选择合适的路由，但不保证各个分组有序到达，其有序交给高层负责
		2.3、定义了标准的分组格式和协议，即IP，目前是IPv4

	3、运输层
		tip：与OSI相似
		3.1、协议：TCP、UDP
		3.2、功能：发送端和目的端主机上的对等实体进行会话，流量控制、差错控制；可靠连接服务/不可靠无连接服务

	4、应用层
		4.1、协议：Telnet、FTP、HTTP、SMTP、DNS、RTP.......

===五层协议体系结构===
	物理层
	数据链路层
	网络层
	运输层
	应用层

# OSI模型中3个主要概念：服务、接口、协议

===计算机网络性能===
	1、速率：数据的传送速率bit/s
	2、带宽：bit/s，数据量/发送时延；单位时间内网络中的某信道所能通过的最高数据率
	3、吞吐量：单位时间内，通过某个网络/信道/接口的实际数据量
	4、时延：发送/传输时延(数据帧长度/发送速率)、传播时延(信道长度/传播速率)、处理时延、排队时延
		4.1、发送时延发生在机器内部的发送器中，一般是网络适配器/网卡
	5、时延带宽积：传播时延 * 带宽；也称为以比特为单位的链路长度
	6、往返时间RTT，2倍的传播时延
	7、信道利用率 = 发送时延 / (传播时延 + 发送时延 + ...)
		7.1、信道利用率：某信道有百分之几的时间是被占用的
		7.2、网络利用率：全网络1的信道利用率的加权平均
		利用率过高，就会产生非常大的时延



==================================以下讨论的各个层次，均为五层协议体系结构======================================

						===物理层===
===数据通信过程===
1、源系统（源点、发送器）-》传输系统（公用电话网）-》目的系统（接收器、终点）
2、一般发送器和接收器内含 调制解调器

# 主要功能：信号的编码和译码、比特的接收与传输

===电路交换===
（传送的数据量很大且其传送时间远大于呼叫时间时）
= 这一路径在整个数据传输期间一直被独占，直到通信结束后才被释放
= 优点：通信时延小、有序传输、没有冲突、适用范围广、实时性强、控制简单
= 缺点：建立连接时间长、线路独占、灵活性差、难以规格化
= 不提供差错控制功能

===报文交换===
= 无连接、存储转发
= 优点：无需建立连接、动态分配线路、提高线路可靠性、提高线路利用率、提供多目标服务
= 缺点：会引起转发时延、对报文大小没有限制，要求网络节点有较大缓存空间

===分组交换===
（端到端的通路由多段链路组成，计算机间突发式数据通信）
=存储转发、限制了每次传送数据的数据块大小的上限，把大的块分为合理的小块，再加上必要控制信息构成分组
= 优点：无建立时延、线路利用率高、简化了存储管理、加速传输、减少了出错概率和重发数据量
= 缺点：存在存储转发时延、需要传输额外的信息量、采用数据报服务时，会出现失序、丢失或重复分组

===网络层提供服务=== 分组交换的两种方式
# 数据报服务：无连接，不同分组可走不同路径，按不同顺序到达目的结点
# 虚电路服务
	= 面向连接，将数据报方式和电路交换方式结合起来
	= 建立一条逻辑上的虚电路，连接建立后，物理路径就固定下来
	= 具有流量控制、差错控制、按序达到功能
	= 如果中间的物理节点破坏，那过这个点的所有虚电路都坏了


===调制===
1、由于计算机输出的信号都属于基带信号，其往往包含较多的低频分量甚至是直流分量，而许多信道并不能传输这种低频分量或直流分量；
	为了解决这类问题，就必须对基带信号进行调制
2、调制类型
	2.1、基带调制/编码：仅对基带信号的波形进行变换，使它能与信道特性相适应；变换后的信号仍然是基带信号；是把数字信号转换为另一种形式的数字信号
		2.1.1、编码类型（均是将数字数据编码为数字信号）
			归零编码RZ：高电平1，低电平0（或相反），每个时钟周期中间，会跳变到0，有自同步
			非归零编码NRZ：不用归零，无自同步
			反向非归零编码NRZI：信号反转代表0，保持不变代表1，自同步
			曼彻斯特编码(包含同步信息)
		2.1.2、差分曼彻斯特编码：若码元为1，则前半个码元的电平与上一码元的后半个码元的电平相同；若码元为0，则情形相反
		2.1.3、曼彻斯特编码：前一个间隔为高电平而后一个间隔为低电平表示码元1，码元为0，情形相反；自含时钟编码的编码方式
	2.2、带通调制：使用载波进行调制，把基带信号频率范围搬移到较高的频段，并转换为模拟信号，使其更好的在模拟信道中传输；调制后的信号称为带通信号
		2.2.1、编码类型：调幅ASK、调频FSK、调相PSK ；
		2.2.2、QAM是一种用模拟信号传输数字数据的编码方式
		2.2.3、脉冲编码调制(PCM)：使用数字信号编码模拟数据
		2.2.4、但为了达到更高的信息传输速率，必须采用技术上更为复杂的多元制的振幅相位混合调制方法，如 正交振幅调制QAM
	2.3、频带传输：利用模拟通信信道传输数字信号的方法，远距离或无线传输时，数字信号必须用频带传输技术进行传输
	2.4、宽带传输：借助频带传输，将链路容量分解为多个信道，就是宽带传输


===信道的极限容量===
1、由来：由于码元传输速率越高、信号传输的距离远、噪声干扰越大或传输媒体质量越差，在接收端的波形失真就越严重
2、信道能通过的频率范围
	2.1、奈氏准则：在带宽为W(Hz)的低通信道中，若不考虑噪声影响，则码元传输的最高速率是2W(码元/秒)；传输速率超过此上限，就会出现严重的码间串扰问题，
		使接收端对码元的判决成为不可能
	2.2、奈奎斯特定理/采样定理：
		= 将模拟信号转换成数字信号时，假设原始信号中的最大频率为f，那么采样频率fc必须>=2f，才能保证采样后的数字信号完整保留原始模拟信号的信息
		= 理想低通信道下的极限数据传输速率 = 2W(带宽)log2 V(离散电平的数目)
	2.3、奈氏准则激励工程人员不断探索更加先进的编码技术，使每一个码元携带更多比特的信息量
3、信噪比
	3.1、噪声的影响是相对的，信号相对较强，噪声影响相对较弱，因此考虑信噪比
	3.2、信噪比：信号的平均功率/噪声的平均功率之比，记为S/N，通常使用dB作为度量单位
		即，信噪比(dB) = 10 log10 (S/N) (dB)
	3.3、香农公式：信道的极限信息传输速率C是，C = W log2 (1 + S/N) (bits/s)
		W为信道带宽、S为信道内所传信号的平均功率，N为信道内部的高斯噪声功率
		概念：信道的带宽或信道中的信噪比越大，信息的极限传输速率就越高，其指出了信息传输速率的上限；
		意义：只要信息传输速率低于信道的极限信息传输速率，就一定存在某种办法来实现无差错的传输
	3.4、香农公式告诫工程人员，在有噪声的实际信道上，不论采用多么复杂的编码技术，都不可能突破公式给出的信息传输速率的绝对极限
4、提高码元携带的比特信息量
	4.1、例如用3位二进制位，能表示8种信息
	4.2、但不能提高任意倍，有噪声干扰容易误码

# 波特率：数值上，等于比特率/每符号所含的比特数的比值；逻辑上，等于每秒可能发生的信号变化次数
# 比特率 = 波特率 * log2 n；一个码元含有的k个比特数，有2^k个有效离散值


===物理层下的传输媒体===
1、导引型传输媒体
	1.1、电磁波被导引沿着固体媒体传播
	1.2、双绞线（电话线）
		1.2.1、绞合可减少对相邻导线的电磁干扰
		1.2.2、一定数量的双绞线捆成电缆，在其外面包上护套；现在的以太网基本上也是使用各种类型双绞线电缆进行连接
		1.2.3、一般通信距离为几公里或十几公里；距离太长就要加上《放大器》以便将衰减了的信号放大到合适的数值(模拟传输)，
			或者加上《中继器》对失真数字信号进行整形(数字传输)
		1.2.4、为了将电话线引入网络通信，增加双绞线的绞合度以及增加电磁屏蔽
		1.2.5、双绞线类型：
			1、无屏蔽双绞线UTP：价格便宜
			2、屏蔽双绞线STP
			3、x/UTP：对整个双绞线电缆进行屏蔽
				x为F(Foiled)，则表明采用铝箔屏蔽层
				x为S(braid Screen)，则表明采用金属编织层进行屏蔽
				x为SF，在铝箔外再加一层金属编织层
			4、FTP、F/FTP、S/FTP
	1.3、同轴电缆：具有较好抗干扰，广泛用于传输较高速率的数据
		1.3.1、主要用在有线电视网的居民小区中
		1.3.2、其带宽取决于电缆质量
	1.4、光缆/光纤
		= 利用光导纤维传递光脉冲来进行通信，有光脉冲为1，没有为0；
		= 由于光的频率非常高，因此一个光纤通信系统的传输带宽远远大于目前其他各种传输媒体的带宽
		= 发送端有光源，可采用发光二极管或半导体激光器，它们在电脉冲的作用下能产生光脉冲；
		= 接收端利用光电二极管做成光检测器，在检测到光脉冲时，可还原出电脉冲
		= 光纤主要由纤芯和包层构成双层通信圆柱体，光波通过纤芯进行传导的；
		= 包层较纤芯有较低的折射率，如果入射角足够大，就会出现全反射，即光线碰到包层时就会折射会纤芯，这个过程不断重复，光也就沿着光纤传输下去
		1.4.1、通信容量大、传输损耗小，中继距离长、抗雷电和电磁干扰性能好、无串音干扰，保密性好、体积小重量轻
		1.4.2、广泛用于计算机网络、电信网络、有线电视网络的主干网络中
		1.4.3、多模光纤：可以存在多条不同达到全反射的角度入射的光线在一条光纤中传输，光脉冲在其中传输时会逐渐展宽，造成失真；只适用于近距离传输
		1.4.4、单模光纤：若光纤的直径减小到只有几个光波长的量级，则光纤就像一根波导那样，可使光线一直向前传播而不会产生多次反射；成本高，得使用昂贵的半导体激光器
		= 光缆，少则1条光纤，多则数十至数百根光纤；里面加上加强芯、填充物、包带层、外护套等就可以大大提高其机械强度
	1.5、架空明线：路上电线杆的线，农村、边远地区才有
2、非导引型传输媒体
	= 指自由空间，电磁波传输为无线传播
	= 利用无线信道传送数字信号时，必须使误码率不大于可容许的范围
		= 对于给定的调制方式和数据率，信噪比越大，误码率就越低
		= 对于同样的信噪比，具有更高数据率的调制技术的误码率也更高
		= 如果移动用户在进行通信时还在不断改变自己的地理位置，就会引起无线信道特性的改变，因而信噪比和误码率都会发生变化；所以物理层要有自适应性
	1、微波通信
		= 中继站进行加强微波信号
		= 无线电微波通信在当前得数据通信中占有特殊重要的地位，微波在空间主要是直线传播，地球是曲面，所以传播距离有限(50km左右)；如果用100m高天线塔，可增大到100km
		= 微波会穿透电离层而进入宇宙空间，不像短波那样可以经电离层反射传播到地面上很远的地方
		= 多径效应：使用微波频段的无线蜂窝通信系统中，基站向手机发送的信号被障碍物阻挡了，经过障碍物反射达到手机，多个路径的信号叠加后一般都会产生很大的失真
		= 为了实现远距离通信，需要在微波通信信道的两个终端之间建立若干个中继站，前一站信号放大后送入下一站，成为微波接力
		= 特点
			= 微波频率高，频段范围宽，所以其通信信道的容量很大
			= 工业干扰和天电干扰对其影响小，传输质量高
			= 与电缆比，建设投资少，见效快，易于跨越山区、江河
		= 缺点
			= 相邻站之间必须直视不能有障碍物
			= 受恶劣气候影响
			= 屏蔽性和保密性较差
			= 对中继站的维护需要大量人力物力
	2、短波通信
		= 主要靠电离层的反射，但电离层的不稳定所产生的衰落现象，以及电离层反射所产生的多径效应，使得短波信道的通信质量较差
	3、卫星通信：作为中继器，进行微波接力通信
		= 优点：距离远、频带宽、通信容量大、信号所受干扰小、通信较稳定
		= 缺点：具有较大传播时延
		= 适用于广播通信，保密性相对较差、费用高


===物理层接口的特性===
1、机械特性：指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置
2、电气特性：指明在接口电缆的各条线上出现的电压的范围
3、功能特性：指明某条线上出现的某一电平的电压表示何种意义
4、过程/规程特性：指明对于不同功能的各种可能事件的出现顺序

===中继器===
= 用来扩大网络规模的最简单廉价的互连设备，通常只有2个端口
= 其两端的网络部分是网段，而不是子网，使用中继器连接的几个网段仍然是一个局域网
= 中继器若出现故障，对相邻两个网段的工作都将产生影响
= 中继器工作在物理层，因此它不能连接两个具有不同速率的局域网
= 如果某个网络设备具有存储转发功能，那么可以认为它能连接两个不同协议，反之同理；而中继器没有存储转发功能，因此其不能连接两个速率不同的网段，两端网段一定是同一个协议

# 转发器：放大信号
# 网桥：用来连接两个网段以扩展物理网络的覆盖范围
# 路由器：实现不同网络的互连
# 5-3-4规则：5个网段、4个中继器或集线器、3个网段为主机段




						===数据链路层===
===使用的信道类型===
= 点对点信道（点对点链路使用的方式）
= 广播信道（局域网使用的方式）


===三个基本问题===
= 封装成帧
	= 识别物理层的01比特流，提取出帧
	===帧定界符===
		= 当数据是由可打印的ASCII码组成的文本文件时，帧定界可以使用特殊的帧定界符；
		= ASCII码是7位编码，128个不同的ASCII码，其中可打印的有95个，而不可打印的控制字符有33个；
		= 控制字符：SOH(start of header)、EOT(end of transmission)
= 透明传输
	= 当传送的帧是非ASCII码组成的帧时，没有帧界定符，显然不是透明传输了；
	= 解决方法
		= 字符/字节填充：前面添加转义字符
= 差错检测（比特差错，帧丢失、乱序等不考虑）
	= 循环冗余CRC检测，检测单比特错误；硬件完成的
	= 所以并不是可靠传输
	= 由于OSI提出让数据链路层像上提供可靠传输，所以在CRC基础上，增加了帧编号、确认和重传机制；
		但现在的通信质量已经大大提高，所以区别对待：
			通信质量好的有线传输线路，数据链路层不使用确认和重传机制；改正任务交给上层协议
			通信质量较差的无线传输线路，使用确认和重传机制，数据链路层向上提供可靠传输
    = 海明码，纠正1位错误
    = 奇偶校验，检测单位错误，双位不行

===每种链路层协议都规定了所能传送的帧的数据部分长度上限---最大传送单元MTU(Maximum Transfer Unit)
= 以太网帧的最大传送单元(MTU)为1500B

===PPP & HDLC & SLIP协议===
= HDLC
	= 通信线路质量较差的年代，在数据链路层使用可靠传输协议曾是一种好办法；能实现可靠传输的高级数据链路控制HDLC(high level data link control)就成为当时比较流行的协议
	= 现在对于点对点的链路，简单的多的PPP协议则是最广泛的协议
= SLIP
    = serial line IP，一种在串行线路上对IP数据报进行封装的简单形式
= PPP
    = SLIP的升级版
	= 只支持点对点链路通信、全双工链路
	= 帧格式：P81课本（F(7E, 1字节)，A(FF, 1字节)，C(03, 1字节)，协议(2字节)，信息部分(不超过1500B)，FCS(2字节)，F(7E，1字节)）
		= F是帧定界符；A、C是扩充定义，但现在还没用到
		= 协议：0x0021:信息字段为IP数据报；0xC021:链路控制协议LCP的数据；0x8021:网络层控制数据
		= FCS：使用CRC的帧检验序列
    = 字符计数法：在帧头部使用一个计数字段来标明帧内字符数
	= 字节填充：转义字符定义为0x7D
	= 零比特填充：PPP用在SONET/SDH链路时，使用同步传输，这时PPP采用零比特填充方法来实现透明传输
		= 具体做法：只要发现5个连续1，则立即填入一个0





==================================以下讨论，均基于传统以太网(总线型)==========================================
===广播信道===
= 到了广播，就引入了共享信道问题了
	= 静态划分：频分、时分、波分、码分等
	= 动态媒体接入控制/多点接入：
		= 随机接入：碰撞检测等问题
			= 载波监听CSMA/CD
			= 曼彻斯特编码(所占频带宽度比原始的基带信号增加了一倍)
		= 受控接入：分散控制的令牌环局域网、集中控制的多点线路轮询等


===局域网&以太网的发展===
= 由于集线器的出现和双绞线大量用于局域网中，星形以太网以及多级星形结构的以太网获得了非常广泛的应用
= 总线网以传统以太网最为著名，后来以太网演变为星形网；
= 现在以太网已成为了局域网的同义词
= 最开始以太网是一种基带总线局域网；以太网用无源电缆作为总线来传送数据帧，并以曾经在历史上表示传播电磁波的以太(Ether)来命名
= 为了使数据链路层能更好的适应多种局域网标准，IEEE 802委员会就把局域网的数据链路层拆成两个子层：
	逻辑链路控制LLC(Logical Link Control)子层，媒体接入控制MAC(Medium Access Control)子层
	= 与接入到传输媒体有关的内容都放在MAC子层，而LLC子层则与传输媒体无关
	= MAC子层主要功能：组帧和拆帧、比特差错检测、寻址、竞争处理
	= LLC子层主要功能：建立和释放数据链路层的逻辑连接、提供与高层的接口、差错控制、给帧加序号
= 然而后续的发展，导致LLC子层作用消失，很多厂商生产的适配器上就仅装有MAC协议而没有LLC协议
= IEEE 802委员会
	= 专门制定局域网和城域网标准的机构
= 使用集线器的星形拓扑
	= IEEE指定了星形以太网10BASE-T的标准802.3i，从此以太网的拓扑就从总线型变为更加方便的星形网络；是局域网发展史上一个重要的里程碑
	= 双绞线以太网总是和集线器配合使用
	= 使用集线器的以太网逻辑上仍是一个总线网，各站共享逻辑上的总线，使用CSMA/CD协议，必须竞争对传输媒体的控制
	= 集线器有多个端口，很像多端口转发器
	= 集线器工作在物理层，每个端口仅转发比特，不进行碰撞检测


===适配器===
= 计算机与外界局域网的连接是通过适配器；主机箱内插入的一块网络接口板/网卡；现在已经嵌入主板上
= 计算机的MAC地址就在适配器的ROM中，而软件地址IP则在计算机存储器中


===以太网的MAC层===
= 局域网中，物理地址 == 硬件地址 == MAC地址 == 适配器地址
= 如果连接在局域网上的主机或路由器安装有多个适配器，那么这样的主机或路由器就有多个MAC地址
= 现在局域网适配器实际上使用的都是6字节MAC地址
	= 前三个字节，由IEEE的注册管理机构RA(registration authority)分配；称为 组织唯一标识符OUI
	= 后三个字节，由厂家自行指派，称为 扩展标识符；如华为公司购买的多个OUI之一：A8-E5-44
	= IEEE把MAC地址的第一字节的最低有效位为I/G位(Individual/Group)，当I/G位为0，表示单个站地址；为1，表示组地址，用来进行多播；
	= IEEE把MAC地址的第一字节的最低第二位规定为G/L位(Global/Local)，为0，全球管理；为1，本地管理（如果不愿意购买OUI）
	
	= 当路由器通过适配器连接到局域网，适配器地址就用来标志路由器的某个接口；如果路由器同时连接到两个网络上，那么它就需要两个适配器和两个MAC地址
	= 适配器过滤：
		= 所有适配器至少能识别单播帧、广播帧（多播帧不考虑）
		= 混杂方式：工作在此方式的适配器，只要听到有帧在以太网传输就悄悄接收下来，窃听而不中断其他人的连接

= MAC：用来决定广播信道中信道分配的协议属于数据链路层的一个子层，称为介质访问控制(Medium Access Control，MAC)子层
	由12个16进制数表示，如：02-60-8c-e4-b1-21，高24位为厂商代码，低24位为厂商自行分配的网卡序列号
= MAC地址：全世界的每块网卡(网络适配器)在出厂时都有一个唯一的代码

= MAC帧格式： 目的地址(6B)，源地址(6B)，类型(2B)，数据(46B~1500B)，FCS(4B)
	= 目的MAC和源MAC地址
	= 类型字段，标志上层使用的协议，把收到的MAC帧的数据上交给上一层协议，如0x0800，IP数据报
	= 46B：最小长度64B-18B的首部和尾部（6B+6B+2B+4B）
	= 帧检验序列FCS：检验范围是整个MAC帧，从目的地址到FCS，但不包括物理层插入的8B的前同步码(7B)和帧开始定界符(1B)
	
	= 没有帧长度字段，因为采用曼彻斯特编码，自同步来判断传输结束
	= 当数据小于46B时，会在数据字段后面加入一个整数字节的填充字段
	= 由于适配器时钟要和到达的比特流达成位同步，所以要添加前同步码（SONET/SDH同步传输时，不需要前同步码）

===802.11局域网的MAC帧===
= 共有三在类型，数据帧、控制帧、管理帧
P109 王道
= 数据帧格式：MAC首部(30B)、帧主体(<=2312B)、帧检验序列FCS(4B)
= 802.11帧的地址字段最常用的两种情况：
    1、去往AP：0；来自AP：1；地址1：接收地址=目的地址；地址2：发送地址=AP地址；地址3：源地址
    2、去往AP：1；来自AP：0；地址1：接收地址=AP地址；地址2：发送地址=源地址；地址3：目的地址

= MAC协议提供的是：无连接的不可靠服务
= MAC的广播地址是fffffffff

= PDU地址即为MAC地址



===集线器(hub)===
= 多端口的中继器，共享设备，效率差，有4个或更多端口
= 如果多个端口输入，输出时会发生冲突，不能分割冲突域，致使这些数据都无效
= 转发时，转发到除输入端口外，其他所有处于工作状态的端口
= 只起放大和转发作用，目的是扩大网络传输范围，不具备信号定向传送能力
= Hub的每个端口连接的网络部分是同一个网络的不同网段，同时Hub也只能在半双工下工作，网络吞吐量因而受到限制

===扩展的以太网===
= 物理层上：通过集线器连接多个以太网，但是多个碰撞域会合并为一个大的碰撞域；且不支持多种协议，协议必须相同；
= 数据链路层上：最初使用网桥，网桥对收到的帧根据其MAC帧的目的地址进行转发和过滤；根据帧的目的MAC，查找网桥中的地址表，然后确定将该帧转发到哪一个端口；或者丢弃
= 后来的交换式集线器代替了网桥，也就是交换机；（多端口网桥）
	= 直接与一个单台主机或另一个以太网交换机相连，全双工，并行性
	= 相互通信的主机都独占传输媒体，无碰撞的传输数据
	= 每一个端口和连接到该端口的主机构成一个碰撞域，具有N端口的以太网交换机，碰撞域有N个
	= 即插即用设备
	= 交换机有直通交换和存储转发交换，直通交换只检查帧的目的地址6B，而存储转发则需要查找转发表

	= 网段：多个以太网通过网桥连接后，就成为一个覆盖范围更大的以太网，而原来的每个以太网就称为一个网段
	= 过滤：决定一个帧是应该转发到某个端口还是应该将其丢弃，称为过滤
	= 转发：决定一个帧应该被移动到哪个接口，称为转发
	= 过滤和转发，均借助于交换表(自学习算法)完成

	= 总线型以太网使用CSMA/CD协议，半双工；以太网交换机全双工




===可靠传输机制===
= 数据链路层的可靠传输通常使用确认和超时重传两种机制完成
= 确认是无数据的控制帧，有些情况下将确认帧稍带在一个回复帧中，成为稍带确认
= 超时重传是指发送方发送某个数据帧后就开启一个计时器，一定时间内没有得到其确认帧，就重新发送，直到发送成功为止

= ARQ(Automatic Repeat reQuest): 自动重传请求
= 通过接收方请求发送方重传出错的数据帧来恢复出错的帧，处理信道带来差错的方法之一
= 传统ARQ分为3种(B为单位传送)
    = 停止-等待(Stop-and-Wait)ARQ
         = 发送方发送一帧，接收方收到一帧，并反馈应答，每次只允许发送一帧，传输效率很低 
         = 发送窗口大小 = 1，接受窗口大小 = 1
    = 后退N帧(Go-Back-N)ARQ
        = 当接收方检测出失序的信息帧后，要求发送方重发最后一个正确接收的信息帧之后的所有未被确认的帧
        = 累积确认
        = 发送窗口大小 > 1，接受窗口大小 = 1
        1、发送窗口1 < WT <= 2^n - 1    (采用n比特 对帧进行编号，大于2^n-1会造成接收方无法分辨新帧和旧帧)
        2、接收窗口为1
        = 传输质量很差导致误码率较大时，GBN不一定优于SW
    = 选择性重传(Selective Repeat)ARQ
        = 只重传出现差错/计时器超时的数据帧；先收下发送序号不连续但仍处在接收窗口中的那些数据帧，等到所缺序号的数据帧收到后再一并送交主机
        = 发送窗口大小 > 1，接受窗口大小 > 1; 通常二者相同，不同无意义
        1、WT = WR <= 2^(n-1)   (如果大于，接收方无法分辨新帧和旧帧)
        2、避免了GBN的冗余回退

    = 连续ARQ，发送窗口大小 <= 窗口总数 - 1
    = 由于，后两个ARQ滑动窗口>1，所以也叫连续ARQ

===为了使信道利用率到达最大===
= 在发送一帧的传输和传播时延这段时间内，不断进行传输帧
= 利用率 = 发送数据的时间/发送时间+传播时间+确认时间


===介质访问控制===
	1、信道划分介质访问控制
		= 频分FDM(传输模拟信号)
		= 时分TDM(抗干扰、可以再生整形、传输数字信号)
		= 统计时分复用STDM：使用STDM的集中器(智能集中器)连接4个低速用户，然后将数据集中起来通过高速线路发送到一个远地计算机
			如果所有用户不间断向集中器发送，其无法应付
			还需要存放用户地址信息
		= 波分WDM
		= 码分CDM多路复用

	2、随机访问介质访问控制(ALOHA、CSMA、CSMA/CD、CSMA/CA)
		普通ALOHA：不进行检测直接发送数据，超时重传；吞吐量较低
		时隙ALOHA：将各站在时间上同步，将时间划分为等长的时隙；每个时隙开始时才能发送一个帧；比普通吞吐量大一倍
		CSMA：多一个载波监听装置；
			1-坚持CSMA：不考虑延迟；信道忙，继续监听
			非坚持CSMA：信道忙，放弃监听；随机时间后，再继续监听
			p-坚持CSMA：信道忙，持续监听；信道空闲，以p概率发送数据，以1-p推迟到下一个时隙
		CSMA/CD：碰撞检测；先听后发，边听边发，冲突停发，随机重发
			1.1冲突窗口/碰撞窗口/争用期：以太网端到端往返时间2t
			1.2最短帧长：64B，64B后一定是正常帧，因为已经成功抢占了信道；如果发送的数据量小，则需要加入一个整数字节填充字段
			1.3截断二进制指数退避算法：确定基本退避时间，一般是2t；
                = 定义参数k，k={重传次数、10}；
                = 从{0,1,..,2^k-1}随机取出一个数r作为时间倍数
			    = 重传次数达到16次仍失败，则表示网络拥挤，报错.
		CSMA/CA：碰撞避免，适用于无线局域网；使用确认重传方案(每收到一确认帧，才发送下一帧)；
                = 退避算法：设置计时器，信道空闲时，进行倒计时，为0时发送帧并等待确认
                = 信道预约：交换请求发送帧RTS(Request to Send)和清除发送帧CTS(Clear to Send)帧
                = 为了尽量避免碰撞，802.11规定所有站完成发送后，必须再等待一段很短的时间(继续监听)才能发送下一帧；这段时间成为帧间间隔IFS
                = IFS长度取决于该站要发送的帧的类型
                    = SIFS(短IFS)：最短的IFS，用来分隔属于一次对话的各帧；例如：ACK帧、CTS帧、分片后的数据帧、所有回答AP探询的帧
                    = PIFS(点协调IFS)：中等长度IFS，在PCF操作中使用
                    = DIFS(分布式协调IFS)：最长的IFS，用于异步帧竞争访问的时延
		= 最短帧长 = 总线传播时延 * 数据传输速率 * 2 or W * RTT     (W为数据传输速率，RTT为往返时间)
        = 争议期：信道在最远两个端点之间往返传输的时间，发送时延 >= 端到端之间的传播时延 * 2
		= 凡长度小于64字节的帧，都是由于冲突而异常中止的无效帧

        = 隐蔽站问题：站A和B相距较远，彼此听不见对方，当A和B检测到信道空闲时，都向AP发送数据导致碰撞；
            = 解决：发送站对信道进行预约，源站要发送数据帧之前先广播一个很短的请求发送RTS控制帧(包括源地址、目的地址、这次通信所持续的时间)，该帧
                    能被其范围内包括AP的所有站点听到，若空闲，则AP广播一个允许发送CTS控制帧(包括这次通信所需的持续时间)，该帧也能被其范围内包括AB在内
                    的所有站点听到；B和其他站听到CTS后，在指定时间内抑制发送

	3、轮询访问：令牌传递协议


===虚拟局域网===
= 在MAC帧中插入4B的标识符，指明发送该帧的计算机属于哪个虚拟局域网，称为802.1Q帧
= 插入在源地址和类型字段之间，其前两个字节总设置为0x8100，称为IEEE 802.1Q标签类型
= 后两个字节，前4位，没用；后12位，VALN标识符VID
= 可以跨越不同交换机，前提交换机能识别VLAN

= 汇聚链路：拦截两个交换机端口之间的链路
= 不同VLAN的通信需要路由器，但有的交换机嵌入了转发模块，用来在不同的VLAN之间转发帧，这样不使用路由器了；这种转发功能称为第三层交换，交换机称为L3/L2交换机
= VLAN建立在交换技术基础上，以软件方式实现逻辑分组与管理
= 划分VALN的方式：基于端口、基于MAC地址、基于IP地址

= 链路聚合：解决交换机之间的宽带瓶颈问题的技术

===高速以太网===
= 10BASE-2：10表示数据率Mb/s；BASE表示基带传输；2表示每段电缆的最长长度为200m；T表示双绞线；F表示光纤
= 100BASE-T以太网
	= 在双绞线上传送100Mbits.s基带信号的星形拓扑以太网，使用CSMA/CD，也叫快速以太网
    = 100BASE-T以太网：既支持全双工，又支持半双工
	= 三种不同物理层标准
		名称		媒体	网段最大长度	特点
		= 100BASE-TX	铜缆	100m		两对UTP 5类线或屏蔽双绞线STP
		= 100BASE-T4	铜缆	100m		4对UTP3 类线或5类线
		= 100BASE-FX	光缆	2000m		两个光纤，发送和接收各用一根
= 吉比特以太网
	特点：
		= 允许在1Gbits/s下以全双工和半双工两种方式工作
		= 半双工下CSMA/CD，全双工下不适用
		= 与10BASE-T和100BASE-T技术 向后兼容
	= 可以用于网络的主干网，也可在高带宽场景中连接计算机和服务器
	
	= 吉比特以太网物理层标准
		名称		媒体	网段最大长度	特点
		= 1000BASE-SX	光缆	550m		多模光纤
		= 1000BASE-LX	光缆	5000m		单模光纤
		= 1000BASE-CX	铜缆	25m		使用2对屏蔽双绞线电缆STP
		= 1000BASE-T	铜缆	100m		使用4对UTP 5类线
= 10吉比特以太网和更快以太网
	= 全双工
    = 10吉比特以太网：只使用光纤作为传输媒体，只工作在全双工方式


# 使用802.1系列协议的局域网又称WiFi
# 局域网最小构件是基本服务集BSS，各站可以在BSS内通信，也可以与本BSS外部站通信，都必须通过本BSS的AP；
	安装AP时，必须为其分配一个不超过32字节的服务集标识符SSID和一个信道
# 扩展的BSS为ESS，通过Portal的设备为用户提供 到有线连接的以太网接入
# 局域网仅工作在OSI参考模型的物理层和数据链路层；而广域网工作在OSI参考模型的下三层
# 以太网卡的同步机制是：曼彻斯特编码
# 以太网中的通信方式：广播，包括发送方，也能接收到自己的信息
# 吉比特以太网的物理层有两个标准：IEEE 802.3z和IEEE 802.3ab，前者采用光纤通道，后者采用4对UTP5类线
# 广域网是因特网的核心部分，其任务是长距离运送主机所发送的数据，由交换机和链路组成
# 结点交换机(switch，多端口网桥，各端口速率不同、全双工)在单个网络中转发分组，而路由器在多个网络构成的互联网中转发
# 广域网 数据链路层协议：PPP(特殊字符填充法，支持不同的网络层协议)、HDLC(比特填充的特殊标记法)
# 广域网的通信方式：存储转发
# 网络层可以隔离冲突域和广播域；数据链路层仅能隔离冲突域；物理层均不能隔离
# 交换机实现的虚拟局域网，可以隔离冲突域和广播域
# 自学习算法中，即使当前已经有不符合的端口在表中，广播时，仍然会往此处发送
# 广域网由多个结点交换器组成；
	多个局域网和广域网通过路由器组成互联网；
	一个自治系统，有多个路由器；
	多个自治系统，组成网络


						===网络层===
= 网络层主要任务：转发和路由选择，不提供服务质量的承诺


===分为控制层面和数据层面===
    = 控制层面, 负责进行路由选择算法构造路由表，由软件处理
    = 数据层面，负责查找转发表，数据传送到下一跳，由硬件处理


===直接交付 & 间接交付===
= 看是否经过路由器进行转发数据

# 流量控制：往往是指在发送端和接收端之间的点对点通信量的控制，抑制发送端发送数据的速率，以便使接收端来得及接收
# 拥塞控制：必须保证通信子网能够传送待传送的数据，是一个全局性问题，涉及网络中所有主机、路由器及其他因素
# 拥塞控制方法：开环控制、闭环控制
# 动态路由算法：
	1、距离-向量路由算法：所有结点参与路由选择信息交换，保证路由的有效性和一致性；定期将整个路由表传送给给所有与之直接
				相邻的结点；“好消息传得快，坏消息传得慢”
	2、链路状态路由算法：要求每个参与该算法的结点均具有完全的网络拓扑信息，向所有路由器发送自己相邻的所有路由信息
= IP地址(原来的)：网络号 + 主机号
= 早期IP分类：
    = A类(n = 8)，网络字段占1B，只有7位可供使用；0 + 网络号共8位
        可指派网络号是126个(2^7 - 2)；
        最大主机数：2^24 - 2
        主机号占3B，全0全1不指派，全0主机号表示该IP是本主机所连接到的单个网络地址，即网络号; 全1表示该网络上的所有主机
    = B类(n = 16)，10 + 网络号共16位
        可指派网络号是16384(2^14)；
        最大主机数：2^16 - 2
    = C类(n = 24)，110 + 网络号
        可指派网络号是2097152(2^21)；
        最大主机数：2^8 - 2
    = D类为多播地址(n = 4)，1110 + 网络号
    = E类为保留地址(n = 4)，1111 + 网络号
= 网络号全0的IP表示本网络
= 可分配IP指除去0.0.0.0和127.0.0.1的所有IP
= 网络号为127(01111111)保留作为本地软件环回测试本主机进程之间的通信之用

===一般不指派的特殊IP地址===
网络号：0       主机号：0                       源地址使用：可以    目的地址使用：不可  代表意思：在本网络上的本主机
网络号：0       主机号：X                       源地址使用：可以    目的地址使用：不可  代表意思：在本网络上主机号为X的主机
网络号：全1     主机号：全1                     源地址使用：不可    目的地址使用：可以  代表意思：只在本网络上广播
网络号：Y       主机号：全1                     源地址使用：不可    目的地址使用：可以  代表意思：对网络号为Y的网络上的所有主机进行广播
网络号：127     主机号：非全0或1的任何数        源地址使用：可以    目的地址使用：可以  代表意思：用于本地软件环回测试


= 用转发器或桥接器连接的若干LAN仍然是同一个网络(因为没有隔离广播域)


= 网络地址转换NAT(网关使用此方法，NAT转换表)：可以使得整个专用网只需要一个全球IP地址就可以与因特网连通；将专用网络地址转换为公用地址
	1、节省了IP的消耗
	2、为了网络安全，划出了部分IP地址为私有IP地址；
		私有IP只用于LAN，不用于WAN连接；
		允许私有IP地址被LAN重复使用
	3、私有IP地址网段如下：
        = 一个A类网络、16个连续的B类网络、256个连续的C类网络
		A类：10.0.0.0/8 ~ 10.255.255.255
		B类：172.16.0.0/12 ~ 172.31.255.255
		C类：192.168.0.0/16 ~ 192.168.255.255


= IP地址(现在的，加了个子网)：网络号 + 子网号(从主机号借用若干比特作为子网号) + 主机号
= 使用子网掩码来表示对原网络中主机号的借位
= 默认子网掩码是仅包含网络号，可以动态更改其子网掩码位数(变长子网掩码)
# 无分类编址CIDR：网络前缀 + 主机号
	1、而网络前缀所占的比特数对应于网络号的部分，等效于子网掩码的1部分
	2、CIDR不使用子网，是指CIDR并没有在32位地址中指明若干位作为子网字段；但分配到一个CIDR地址块的组织，仍可以在本组织内根据
		需要划分出一些子网
	3、作用是：把小的网络汇聚成大的超网
    4、查找转发表的算法：二叉线索
= 路由聚合/超网：CIDR地址块表示的一系列地址，缩短了路有表的长度和转发表查找时间
= 定长子网划分：将一个网络地址空间划分为相同大小的子网

= 主机路由：a.b.c.d/32
= 点对点链路(路由器之间的连接, 也叫匿名网络)：a.b.c.d/31
= 默认路由：0.0.0.0/0，子网掩码：0.0.0.0


= ARP请求和DHCP请求过程类似，都是先广播请求，再接收分配
= 地址解析协议ARP：从IP到MAC的映射；用户透明的
    = 每台主机均有ARP缓存，存放映射表，设置生存时间并动态更新；
    = 查找到后添加MAC帧
    = 解决同一个局域网上的映射，通过路由器来完成不同网络转发


= 动态主机配置协议DHCP(应用层)：给主机动态分配IP地址，基于UDP；C/S架构，包含了RARP(逆地址解析协议)功能


= 网际控制报文协议ICMP(网络层)：提高IP数据报交付成功的机会，让主机或路由器报告差错和异常情况
    = 封装在IP数据报的数据部分，IP层协议
    = 分为ICMP差错报告报文和ICMP询问报文
    = 报文格式：前4B是统一格式，共三个字段：类型、代码、检验和；
                接着4B内容与ICMP类型有关
                最后面是数据字段，长度取决于ICMP类型
    = 几种常见类型
        = 差错报告报文：3,终点不可达；
                        11,时间超过；
                        12,参数问题；
                        5,改变路由(Redirect)
        = 询问报文：8或0,回送请求或回送回答；
                    13或14,时间戳请求或时间戳回答
    = 代码字段，进一步区分某种类型中的几种不同情况
    = 检验和字段，检验整个ICMP报文；
    = IP不检验数据部分，所以不保证ICMP不出现差错

    ===不发送ICMP差错报告报文报文的情况===
    = 对ICMP差错报告报文，不再发送ICMP差错报告报文报文
    = 对第一个分片的数据报片的所有后续报片，不发送ICMP差错报告报文报文
    = 对具有多播地址的数据报，不发送ICMP差错报告报文报文
    = 对具有特殊地址的数据报，不发送ICMP差错报告报文报文

    = ping是应用层直接使用网络层ICMP的例子





= IP分组经过多次路由转发到达目标网络后，改为在目标LAN中通过数据链路层MAC地址以广播方式寻址；提高路由选择的效率
= 默认网关：离当前主机最近的路由器的端口地址


===IP分片===
    = IP作为MAC帧的数据部分，如果需要分片，那么IP每片均加上首部，且每片数据部分都是8的整数倍
    = IP数据报封装成MAC帧后，如果超过MTU的值，就进行分片
	1、原IP数据报：首部20B + 数据；将数据段分片，每片前均加上20B的首部
	2、数据的字节序号是从0开始的


===IP数据报首部格式===
    = IP数据报首部的固定部分
        1、版本：IP协议版本：ipv4、ipv6， 占4位                                                              
        2、首部长度：单位为4B，占4位；长度固定部分是20B，没有其他可选项选择
        3、区分服务：占8位，一般不使用
        4、总长度：占16位；单位为字节B；指首部和数据之和的长度
        5、标识：占16位，是个计数器，每个数据报片都复制一次标识号
        6、标志：占3位；
            最低位为MF(More Fragment)，1表示后面还有分片，0表示最后一个分片；
            中间一位是DF(Don't Fragment)，1表示不允许分片，0表示允许分片
        7、片偏移：占13位，单位为8B
        8、生存时间TTL(Time To Live)：占8位，跳数限制，最大跳255
        9、协议：占8位，IP上交到哪种协议处理；
            ICMP：1
            IGMP：2
            IP：4
            TCP：6
            EGP：8
            IGP：9
            UDP：17
            IPv6：41
            ESP：50
            AH：51
            ICMP-IPv6：58
            OSPF：89
        10、首部校验和：占16位，只检验数据报首部，但不包括数据报部分
        11、源地址：占32位
        12、目的地址：占32位
    = IP数据报首部的可变部分
        增加路由器处理开销，很少使用
= IP数据报：首部 + 数据部分




= IP规范规定，所有主机和网关至少能支持576B的分组长度，这个数据报中，512B存放数据，64B用作分组头
= 为了提高网络传输效率，人为规定的

= 带有NAT功能的路由器，IP数据报的目的IP和源IP会进行内部IP与公网IP的转换
= NAT中如果查找不到条目，就直接丢弃分组


===IPv6===
= IPv6提供Qos(满足实时、多媒体通信的需要)保障、首部长度固定，没有校验和字段
    = 支持IPv4和IPv6的通信方法：双协议栈、隧道技术(IPv6封装为IPv4,传送到局域网后，拆封由主机处理IPv6数据报)
    = 在包的源节点才能分片，传输路径中的路由器不能分片，一般意义：IPv6不允许分片
    = 取消了校验和字段
    = 首部长度固定



===路由选择协议===
= 由于网络规模大，所以采用多个小的自治系统AS，由此引出内部网关和外部网关
= 内部网关协议IGP
    = BIP(Routing Information Protocol, udp)：分布式基于距离向量/跳数的路由选择协议、Bellman-Flod
        = 要求网络中每一个路由器都要维护它自己到其他每一个目的网络的距离记录
        = 距离等于16时，即为不可达
        = 距离不可达时，统一以16代表，17、18、19也写为16；同时此路由器丢弃该IP分组，并向目的主机报告目的不可达
        = 只适用于小型互联网
        = 仅和相邻的路由器交换信息
        = 交换的信息是到所有网络的距离和下一跳路由器
        = 按照固定的时间间隔交换路由信息
        = 网络中的主机被动接收路由器发来的路由信息
        = RIP报文作为运输层用户数据报UDP的数据部分进行传送
        = 路由收敛：经过若干RIP广播后，所有路由器都最终知道了整个IP网络的路由表
        = 报文格式：由首部和路由部分组成；
            路由部分填入ASN自治系统号；还要指出目的网络地址、下一跳路由器地址、到此网络的距离、RIP最多可包括25个路由
        = 只能找到一条路径
        = 好消息传的快，坏消息传的慢
    = OSPF(OPen Shortest Path First, IP)链路状态协议、Dijkstra
        = 适用于大规模网络
        = 路由器通过所有输出端口向所有相邻的路由器发送信息(洪泛法)
        = 发送的信息就是与本路由器相邻的所有路由器的链路状态(相邻的哪些路由器、链路代价)
        = 每隔一段时间洪泛一次
        = 收敛快，知道全网拓扑结构
        = 自治系统再划分为小的区域，每个区域路由器不超过200个，总的路由信息由"区域边界路由器"概括
        = 负载均衡

        = OSPF的五种分组类型：
        1、问候(hello)分组：用来发现和维持邻站的可达性
        2、数据库描述分组：向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息
        3、链路状态请求分组：向对方请求发送某些链路状态项目的详细信息
        4、链路状态更新分组：用洪泛法对全网更新链路状态
        5、链路状态确认分组：对链路更新分组的确认
    = IS-IS



= 外部网关协议EGP：BGP-4(tcp)
= 自治系统边界路由器交换信息
    = 外界交换完后，还需要内部BGP交换信息给内部路由器
= BGP-4种报文
	1、打开open报文：用来与相邻的另一个BGP发言人建立关系
	2、更新报文：用来发送某一路由的信息，以及列出要撤销的多条路由
	3、保活报文：用来确认打开报文并周期性地证实邻站关系
	4、通知报文：用来发送检测到地差错


# 组播IGMP：大部分的D类地址
	1、组播一定仅应用于udp
	2、主机使用一个称为IGMP(因特网组管理协议)的协议加入组播组
	3、组播时，主机仅发送一份数据，只有数据在传送路径出现分岔时才将分组复制后继续转发
	4、由于对组播数据报不产生ICMP差错报文，因此，若ping组播地址，将永远不会收到响应
	5、D类地址的后23位可用作组播地址，倒数第24位置为0后映射
    = 组播地址只能用于目的地址，而不能用于源地址
    = 以太网组播范围：01-00-5E-00-00-00 ~ 01-00-5E-7F-FF-FF
    = IGMP：让连接在本地局域网上的多播路由器知道本局域网上是否有主机
# 移动IP：
	1、自己的手机看作一个移动站，移动站在本地网络内时，采用tcp或udp进行通信；
		而当移动站移动到其他局域网时，会先向当地外部代理注册IP，并将此IP发送给本地归属代理；
		当有外界发送IP数据报时，本地归属代理会先截获此IP数据报，然后与分配的IP建立起一个隧道，并将IP数据报封装后，发送
		给外部代理，外部代理解析此封装报为普通IP报，发送给移动站
	2、发送IP报时，通过外部代理直接发送


# 冲突域：指连接到同一物理介质上的所有结点的集合，这些结点之间存在介质争用的现象
# 广播域：指接收同样广播消息的结点的集合
# 路由器(路由选择、分组转发)：是一种具有多个输入输出端口的专用计算机，其任务是连接不同的网络(连接异构网络)并完成路由转发；在多个逻辑网络(即多个广播域)
	互连时必须使用路由器
= 路由交付：分为直接交付和间接交付；当发送站与目的站在同一网段内时，就使用直接交付
= 路由器结构：路由选择处理机(路由选择协议、路由表)，输入端口、输出端口、交换结构


===MPLS多协议标签交换===
= 为了减少查找IP转发表的时间，将IP数据报打上标签，送至数据链路层进行转发



						传输层
===全球通用端口号: 1～1023
===登记端口号: 1024~49151
===客户端端口号/短暂端口号: 49151~65535
===常用端口：TELNET: 23; SMTP: 25; HTTP: 80; FTP: 连接控制21, 数据连接20

# http使用tcp服务

===UDP===
    # udp不支持分片，仅增加了复用分用的功能以及差错检测功能
    = 支持一对一、一对多、多对一、多对多的交互通信
    # udp首部8B，4个字段，每段2B
        1、源端口
        2、目的端口
        3、长度：指总长度
        4、校验和：源IP地址(4B) + 目的IP地址(4B) + 置0(1B) + 17(1B, UDP; 6, TCP) + UDP长度(2B)
            可选字段，不选全置为0，如果校验结果为0, 则置1；校验所有内容，检错能力不强，但是很快
        5、udp提供的校验，如果有误，直接丢弃，无法做到可靠传输(出错需要重传)

===TCP===
= 特点
    = 只能点对点，全双工通信
    = 可靠交付：无差错、不丢失、不重复、按序达到
    = 面向字节流
    = 通过套接字(IP和port拼接)进行通信
= TCP报文段格式(传输单位：B)
    = 前20B是固定的，后面4nB是根据需要而增加的选项
    = 源端口、目的端口：各占2B
    = 序号：占4B，0 - 2^32 - 1，每个字节都按顺序编号；表示本报文段所发送的数据的第一个字节的序号
    = 确认号：占4B，是期望收到对方下一个报文段的第一个数据字节的序号
    = 数据偏移：4bits，指出TCP报文段的数据起始处 距离 TCP报文段的起始处有多远(即TCP首部长度), 单位为4B，最大长度60B
    = 保留：占6bits，为今后使用，置0
    = 6个控制位：
        = 紧急URG：URG=1时，表明有紧急数据 尽快送达，不按原来顺序传送(配合紧急指针)；如Ctrl + C取消远程进程
        = 确认ACK：ACK=1时，确认号字段才有效；TCP规定，在连接建立后，所有传送的报文段都必须把ACK置1
        = 推送PSH：PHS=1，交互式通信，直接回送确认，不等待缓冲区满
        = 复位RST：RST=1时，表明TCP连接中出现严重错误(主机崩溃等)，必须释放连接，再重新建立连接；置1还用来拒绝一个非法报文段或拒绝打开一个连接
        = 同步SYN：同步序号，SYN=1 & ACK=0时，表明这是一个连接请求报文段；若对方同意建立连接，则应在响应的报文段中使SYN=1 & ACK=1
        = 终止FIN：FIN=1时，表明此报文段的发送方的数据已发送完毕，并要求释放连接
        = 窗口：占2B，0 - 2^16 - 1；作为让接收方让发送方设置其发送窗口的依据
        = 校验和：2B，检验首部和数据两部分
        = 紧急指针：占2B，指出本报文段中的紧急数据的字节数，即使窗口为0也可发送紧急数据
        = 选项：长度可变，最大40B
        = 填充：字段仅仅是为了让TCP首部是4B整数倍

        = 选择确认SACK：只重传缺失的，不会回退N帧，成块传送

===MSS最大报文段长度===
= 指TCP数据字段的最大长度
= 默认536B(576B - 40B)

===TCP发送报文时机===
    = 等于MSS时发送
    = 交互式推送
    = 计时器到期
= 由于发送时机很难把握，所以使用Nagle算法
= Nagle算法：
    = 若发送方要把数据逐字节送到TCP缓存中，则发送方就把第一个数据字节先发送出去，把后面到达的数据字节都缓存起来；
    = 当发送方收到对第一个数据字符的确认后，再把发送缓存中的所有数据组成一个报文段发送出去，同时继续对后续到达的数据进行缓存
    = 只有在收到对前一个报文段的确认后才继续发送下一个报文段
    = 当到达的数据已达到发送窗口大小的一半或已达到报文段的最大长度时，就立即发送一个报文段
= 糊涂窗口综合症
    = 窗口一直是1,网络效率很低


===TCP连接建立过程===
= 三握手：
    = client -> server: SYN=1, seq=x
    = server -> client: SYN=1, ACK=1, seq=y, ack=x + 1
    = client -> server: ACK=1, seq=x + 1, ack = y + 1
= 四挥手
    = client -> server: FIN=1, seq=u
    = server -> client: ACK=1, seq=v, ack=u + 1
    = server -> client: FIN=1, ACK=1, seq=w, ack=u + 1
    = client -> server: ACK=1, seq=u + 1, ack=w + 1

== 释放阶段 ==
= 传输结束后，双方都可释放连接
= 当前client和server均处于ESTABLISHED状态
= client发送释放报文段(FIN置1,seq=u，u等于前面已传送过的数据的最后一个字节的序号加1)，停止发送数据，主动关闭TCP；此时client进入FIN-WAIT-1状态
= server收到后发出确认(ack=u + 1, seq=v)，此时处于半关闭(client不发送，但是接收server发送的数据)
= client收到确认后，进入FIN-WAIT-2状态，等待server发出连接释放报文段
= 若server不发送数据，则报文段FIN置1，进入LAST-ACK状态，等待client的确认
= client发送确认后，进入TIME-WAIT状态；现在还没有释放连接
= 经过"时间等待计时器"设置的时间2MSL(最长报文段寿命)后，client才进入CLOSED状态

= server结束时间比client早(谁先请求断开，谁是client)





===发送窗口===
= 表示发送端在未收到确认之前可以发送的最大字节数
= 发送窗口 = min{接收端窗口, 拥塞窗口}

===拥塞窗口cwnd===
= 发送端根据网络拥塞情况确定的值

===重传===
    = 超时重传
    = 冗余ACK/快速重传：连续发送3个ACK

===TCP拥塞控制===
    = 慢开始和拥塞避免
        = 慢开始：建立连接后，先令拥塞窗口为1，即一个MSS长度；每收到一个确认后，cwnd加1；逐步增大cwnd
            = 每经过一个传输轮次即RTT，cwnd就会加倍，指数规律增长
            = 直到增大到慢开始门限ssthresh，开始使用拥塞避免算法
        = 拥塞避免算法(加法增大)：每经过一个RTT，cwnd加1，cwnd线性增长
            = cwnd < ssthresh，使用，慢开始算法
            = cwnd > ssthresh，停止使用慢开始而改使用拥塞避免
            = cwnd = sstresh，两者均可
    
    = 网络拥塞的处理
        = 只要发送方判断网络出现拥塞，就(sstresh = 出现拥塞时cwnd/2 & sstresh >= 2), 然后(cwnd = 1)执行慢开始
        = 慢开始阶段，若2cwnd > sstresh，则下一RTT后，cwnd=sstresh，而不等于2cwnd；即cwnd不能越过sstresh值

    = 快重传和快恢复(前面的改进)
        = 快重传：发送方连续收到3个重复ACK报文时，直接重传对方尚未收到的报文段，而不必等待那个报文段设置的重传计时器超时
        = 快恢复：当发送方收到3个重复ACK时，执行"乘法减小"算法，cwnd=sstresh=cwnd/2，然后从sstresh执行"加法增大"，cwnd线性增大(拥塞避免)

= 使用总结：在TCP建立和网络出现超时时，采用慢开始和拥塞避免；当发送方接收到冗余ACK时，采用快重传和快恢复

===题目中，如果超时，则进行慢开始；如果接收到冗余ACK，则进行快恢复


===关于发送方可发送内容和字节数===
= 如果client发送了0 - 100B，但收到的确认是ack=0，且发送窗口=300
= 则client可再次发送的内容为：100 - 300B共200B



                    ===应用层===
= 根域名服务器
    = 知道所有顶级域名服务器，管辖顶级域
= 顶级域名服务器
    = 管理在该顶级域名服务器注册的所有二级域名
= 授权/权限 域名服务器
    = 每台主机均在此登记，总能将主机名转换为IP地址
= 本地域名服务器
    = 当一台主机发出DNS查询请求时，这个查询请求报文就发送给该主机的本地域名服务器


= 域名解析过程
    = 当客户端需要域名解析时，通过本机的DNS客户端构造一个DNS请求报文，以UDP数据报方式发往本地域名服务器
    = 递归查询
        = 本地域名服务器只需向根域名服务器查询一次，后面的几次查询都是递归在其他几个域名服务器之间进行的；
            查找到后，再递归的传回本机
        = 缺点：根域名服务器负载过大
    = 递归+迭代查询
        = 主机向本地域名服务器的查询采用的是递归查询
        = 本地域名服务器向根域名服务器的查询采用迭代查询
            查找到后，直接由当前域名服务器发送给本机
    = 提供有缓存机制

===如果是http请求，则解析前还需要先建立TCP连接


===文件传输协议FTP===
= 基于TCP
= 提供不同种类主机系统之间的文件传输
= 以匿名FTP方式提供公用文件共享的能力(anonymous作为用户名)
= 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力
= 使用两个并行TCP连接；控制连接使用服务端TCP的21号端口，数据连接使用20号端口
    = 也称带外传输
= 两个线程，一个处理连接，一个处理数据传输
= 如果客户端主动请求连接，则除了20端口外，还会在服务器开放其他端口进行数据传输(PASV模式，被动模式)
= 如果服务器主动请求连接，则只用20号端口数据传输(PORT模式，主动模式)


===电子邮件===
= 地址格式：用户名@邮箱所在主机的域名


===组成结构===
= 用户代理UA：用户与电子邮件系统的接口；如Foxmail
= 邮件服务器：发送和接收邮件，同时向发信人报告邮件传送情况(已交付、被拒绝、丢失等)
= 邮件发送协议和读取协议
    = 邮件发送协议用于用户代理向邮件服务器发送邮件或在邮件服务器之间发送邮件，如SMTP
    = 邮件读取协议用于用户代理从邮件服务器读取邮件，如POP3


= SMTP基于TCP，端口号25，推协议
    = 不同邮件服务器之间使用；浏览器与服务器之间采用HTTP
    = 只能传送7B的ASCII码邮件，且无法传送可执行文件及其他二进制对象，引出了MIME

= MIME多用途网际邮件扩充
    = 并未改动SMTP或取代它，只是基于SMTP扩充了功能
    = 5个新的邮件首部格式，包括MIME版本、内容描述、内容标志、传送编码、内容类型
    = 定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化
    = 定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变
    = 直接在发送方和接收方这两个邮件服务器之间直接建立，而不管它们相隔多远

= POP3基于TCP，端口号110，拉协议
    = 用户代理使用此协议接收邮件
    = 下载并保留/下载并删除两种读取方式

= IMAP支持联机命令，获取部分报文信息


===HTTP===
= HTTP 1.0只支持非持久连接

===Cookie===
    = 服务器产生的，存储在用户主机中的一个文本文件

===Connection===
    = Close表示非持续连接
    = keep-alive表示持续连接方式
